<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>convertImageToDataUrl</title>
</head>

<body>
    <script>
        // https://segmentfault.com/a/1190000021589573
        let img = new Image();
        // img.src = 'https://lh3.googleusercontent.com/proxy/HJ5dP8ZUmJK-WqqlxuRUyvh2xenkR3nItH9zBgg-yOQLPWrSoW9GzcLw8vVxmpLI_yCvToXLpZrMvf04sORXEDtGv9A'
        // img.src = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQmZMuOWiVJm9ip3eMTu9QT07vq5fXoZQxjKw&usqp=CAU'
        // img.src = '/Users/dendi/Desktop/ams/readme-images/vim.png'
        img.src = 'file:///d:/Test/convertImgToDataUrl/test.png'
        // img.setAttribute("crossOrigin", 'Anonymous');
        img.onload = () => {
            console.log(img.width, img.height, 'w, h')
            const base64Img = convertImageToCanvas(img)
            console.log(base64Img)
        }

        // 把image 转换为 canvas对象
        function convertImageToCanvas(img) {
            // 创建canvas DOM元素，并设置其宽高和图片一样
            var canvas = document.createElement("canvas");
            canvas.width = img.width;
            canvas.height = img.height;
            const quality = 0.8;    // 压缩系数0-1之间
            // 坐标(0,0) 表示从此处开始绘制，相当于偏移。
            canvas.getContext("2d").drawImage(img, 0, 0);
            // let hiBlob = new Blob([`<h1>Hi gauseen!<h1>`], { type: 'text/html' })
            let hiBlob = new Blob([canvas], { type: 'image/png' })
            let hiFile = new File([ hiBlob ], 'fileName', { type: 'text/html' })
            console.log(hiFile, '909090')
            document.querySelector('body').appendChild(canvas)
            return canvas.toDataURL('image/png', quality)
        }
    </script>
</body>

</html>
